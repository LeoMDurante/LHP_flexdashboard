---
title: "NOAA Biosampling Species Summaries"
output: 
  flexdashboard::flex_dashboard:
    source_code: "https://github.com/evaschemmel-NOAA-LHP"
    orientation: rows
    vertical_layout: fill
    theme:
      version: 4
      bg: "#FFFFFF"
      fg: "#000000" 
      primary: "#005AA8"
      
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(lubridate)
library(magrittr)
library(ggplot2)
library(dplyr)
library(tidyr)
# Install thematic and un-comment for themed static plots (i.e., ggplot2)
# thematic::thematic_rmd()
```

```{r}
here::i_am("biosampling.Rmd")
```

```{r global, include=FALSE}
# load data in 'global' chunk so it can be shared by all users of the dashboard

data<-read.csv("~/Documents/github/LHP_flexdashboard/data/all_samples.csv")


```

## Column {.sidebar}

Choose a region and species...

```{r}

selectInput("Region", label = "Region:",
            choices = c("A.Samoa", "A.Samoa_unfished", "Guam", "CNMI", "CNMI_unfished"), selected = "A.Samoa")


selectInput("ScientificName", label = "Species",
            choices = unique(data$ScientificName), selected = "Aphareus rutilans")

selectedData <- reactive({
  data[, c(input$Region, input$ScientificName, "Length.cm.", "Sex", "Date", "GonWeight", "Weight.g." )]
})



```


## Species Summary {.tabset data-width="650"}

```{r}
  temp=data
  temp$Month<-month(temp$Date, label=TRUE) #keeps month data in date formatt for plotting in order
  tempm<-temp%>% 
    na.omit(temp)
  Months<-c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "July", "Aug", "Sep", "Oct", "Nov", "Dec")
  Mn=c(1:10, 1)
  Months<-as.data.frame(Months)
  Months<-as.factor(Months$Months)
  tempm<-tempm %>%
    dplyr::group_by(Month)%>%
    dplyr::summarize(N_month=length(Length.cm.))
  maxm<-max(tempm$N_month, na.rm=TRUE)
  maxm<-if (maxm >=20) maxm else 20
  tempm<-tidyr::complete(tempm, Month, fill=list(N_Month=0))
  gsi<-temp %>% 
    dplyr::mutate(GSI=(GonWeight/Weight.g.)*100)
  return(gsi)
  
  #join into list
  build_list<-list(temp, tempm, gsi)
  names(build_list)<- c('temp','tempm','gsi')
  final_list<-build_list
  sample_size=length(final_list$temp$Length.cm.)
  min<-min(final_list$temp$Length.cm., na.rm=TRUE)
  max<-max(final_list$temp$Length.cm., na.rm=TRUE)
  median<-median(final_list$temp$Length.cm., na.rm=TRUE)
  gender<-final_list$temp %>%
    dplyr::group_by(Sex)%>%
    dplyr::summarize(n_females=length(Sex=="F"))
  female=gender[1,2]
  male=gender[2,2]
  unknown=gender[3,2]
  
  maxm<-max(final_list$tempm$N_month, na.rm=TRUE)
  maxm<-if (maxm >=20) maxm else 20
```



A total of `r sample_size` samples (females=`r female`, males=`r male`, unknown/na=`r unknown`) have been collected to date. Median fork length is `r median` cm (min=`r min` cm, max=`r max` cm).
## 4 panel chart

```{r}

renderPlot(dataplot(selectedData()))

```

